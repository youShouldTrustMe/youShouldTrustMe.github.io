---
title: DAC

cover: https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_12_2_202409101612493.png
categories: 
  - 嵌入式
tags:
  - 外设组件
---



# 参考链接

[【STM32】DAC详解_dac12bit-CSDN博客](https://blog.csdn.net/dengjin20104042056/article/details/108604920)

# 简述

DAC,全称：Digital-to-Analog Converter,指数字/模拟转换器

DAC 模块是 12 位电压输出数模转换器。

- DAC 可以按 8 位或 12 位模式进行配置，并且可与DMA 控制器配合使用。
- 在 12 位模式下，数据可以采用左对齐或右对齐。
- DAC 有两个输出通道，每个通道各有一个转换器。在 DAC 双通道模式下，每个通道可以单独进行转换；当两个通道组合在一起同步执行更新操作时，也可以同时进行转换。可通过一个输入参考电压引脚 V REF+ （与 ADC 共享）来提高分辨率。

![ADC和DAC过程](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_12_2_202409101612493.png)

> [!IMPORTANT]
>
> ADC和DAC是模拟电路和数字电路之间的桥梁

## 特性参数

1. 分辨率：表示模拟电压的最小增量，常用二进制位数表示，比如：8、12位等
2. 建立时间：表示将一个数字量转换为稳定模拟信号所需的时间
3. 精度：转换器实际特性曲线与理想特性曲线之间的最大偏差
   1. 误差源：比例系统误差、失调误差、非线性误差
   2. 原因：元件参数误差、基准电压不稳定、运算放大器零漂等

## 主要特性

| 主要特性    | F1                                                           | F4                      | F7          | H7           |
| ----------- | ------------------------------------------------------------ | ----------------------- | ----------- | ------------ |
| DAC输出类型 | 电压输出型                                                   | ==                      | ==          | ==           |
| 分辨率      | 8/12位                                                       | ==                      | ==          | ==           |
| DAC时钟频率 | 36MHz(APB1)                                                  | 42MHz(APB1) 45MHz(APB1) | 54MHz(APB1) | 120MHz(APB1) |
| 建立时间    | 3us                                                          | ==                      | ==          | 1.7us        |
| 供电电压    | Vssa : 0V, VpDa : 2.4V~3.6V                                  | ==                      | ==          | ==           |
| 参考电压    | VReF- : OV, VREE+ 般为3.3V                                   | ==                      | ==          | ==           |
| 输出通道    | DAC_OUT1(PA4）、DAC_OUT2(PA5) 为了避免寄生电流消耗，PA4和PA5配置为模拟功能 每个通道都有单独的转换器，可同时或单独转换，每个通道都有DMA功能 | ==                      | ==          | ==           |

- 两个 DAC 转换器：各对应一个输出通道
- 12 位模式下数据采用左对齐或右对齐
- 同步更新功能
- 生成噪声波
- 生成三角波
- DAC 双通道单独或同时转换
- 每个通道都具有 DMA 功能
- DMA 下溢错误检测
- 通过外部触发信号进行转换
- 输入参考电压 V REF+

# 工作原理

![DAC框图](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_49_2_202409101649073.png)



> [!TIP]
>
> 使能 DAC 通道 x 后，相应 GPIO 引脚（ PA4 或 PA5 ）将自动连接到模拟转换器输出(DAC_OUTx) 。为了避免寄生电流消耗，应首先将 PA4 或 PA5 引脚配置为模拟模式 (AIN) 。

## 参考电压和模拟电压

| 名称     | 信号类型           | 备注                               |
| -------- | ------------------ | ---------------------------------- |
| VREF+    | 正模拟参考电压输入 | DAC 高/正参考电压，1.8V≤VREF+≤VDDA |
| VDDA     | 模拟电源输入       | 模拟电源                           |
| VsSA     | 模拟电源接地输入   | 模拟电源接地                       |
| DAC_OUTx | 模拟输出信号       | DAC 通道×模拟输出 201040420        |

![参考电压和模拟电压](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_50_33_202409101650770.png)



## 数据格式

数据寄存器，是DAC数据转换的来源

![数据格式](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_53_11_202409101653943.png)

## 触发源

![触发源](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_53_6_202409101653109.png)

关闭触发时的转换时序

DAC_DORx 无法直接写入，任何数据都必须通过加载 DAC_DHRx 寄存器（写入DAC_DHR8Rx、DAC_DHR12Lx、DAC_DHR12Rx、DAC_DHR8RD、DAC_DHR12LD 或DAC_DHR12LD）才能传输到 DAC 通道 x。

如果未选择硬件触发（DAC_CR 寄存器中的 TENx 位复位），那么经过一个 APB1 时钟周期后，DAC_DHRx 寄存器中存储的数据将自动转移到 DAC_DORx 寄存器。但是，如果选择硬件触发（置位 DAC_CR 寄存器中的 TENx 位）且触发条件到来，将在三个 APB1 时钟周期后进行转移。

当 DAC_DORx 加载了 DAC_DHRx 内容时，模拟输出电压将在一段时间 t SETTLING 后可用，具体时间取决于电源电压和模拟输出负载。

| 源                 | 类型                          | TSEL[2:0] |
| ------------------ | ----------------------------- | --------- |
| Timer 6 TRGO event | 片上定时器的内部信号 外部引脚 | 000       |
| Timer 8 TRGO event | :                             | 001       |
| Timer 7 TRGO event | :                             | 010       |
| Timer 5 TRGO event | :                             | 011       |
| Timer 2TRGOevent   | :                             | 100       |
| Timer 4 TRGO event | :                             | 101       |
| EXTI line9         | 外部引脚                      | 110       |
| SWTRIG             | 软件控制位                    | 111       |

![波形图](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_53_57_202409101653915.png)

## DMA请求

每个 DAC 通道都具有 DMA 功能。两个 DMA 通道用于处理 DAC 通道的 DMA 请求。当 DMAENx 位置 1 时，如果发生外部触发（而不是软件触发），则将产生 DAC DMA 请求。DAC_DHRx 寄存器的值随后转移到 DAC_DORx 寄存器。

在双通道模式下，如果两个 DMAENx 位均置 1，则将产生两个 DMA 请求。如果只需要一个DMA 请求，应仅将相应 DMAENx 位置 1。这样，应用程序可以在双通道模式下通过一个DMA 请求和一个特定 DMA 通道来管理两个 DAC 通道。

![DMA请求](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_54_12_202409101654004.png)

## 输出电压

经过线性转换后，数字输入会转换为 0 到 V REF+ 之间的输出电压。各DAC通道引脚的模拟输出电压通过以下公式确定：

这里的4096和256分别是2^12 2^8

![输出电压](https://gitlab.com/18355291538/picture/-/raw/main/pictures/2024/09/10_16_55_54_202409101655811.png)







































