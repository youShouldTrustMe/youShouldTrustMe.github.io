---
title: æ“ä½œç³»ç»ŸåŸºç¡€

date: 2025-03-01
lastmod: 2025-03-01
tags:
- åŸºç¡€çŸ¥è¯†
---



# å‚è€ƒé“¾æ¥

[æ“ä½œç³»ç»Ÿï¼šè®¾è®¡ä¸å®ç° (2024 æ˜¥å­£å­¦æœŸ) (jyywiki.cn)](https://jyywiki.cn/OS/2024/)

# åº”ç”¨è§†è§’ä¸‹çš„æ“ä½œç³»ç»Ÿ

## æ„é€ ä¸€ä¸ªæœ€å°ç¨‹åº

è¦ç†è§£æ“ä½œç³»ç»Ÿé¦–å…ˆè¦ç†è§£ç¨‹åº,ä¸‹é¢æ˜¯ä¸€ä¸ªæœ€ç®€å•çš„ç¨‹åºï¼š

```c
int main()
{
	printf("Hello world!");
}
```

å½“ç”Ÿæˆè¾“å‡ºæ–‡ä»¶ä¹‹åï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹çš„å‘½ä»¤æ¥æŸ¥çœ‹ç”Ÿæˆçš„å¯æ‰§è¡Œæ–‡ä»¶

```bash
objdump å·¥å…·å¯ä»¥æŸ¥çœ‹å¯¹åº”çš„æ±‡ç¼–ä»£ç 
gcc --verbose å¯ä»¥æŸ¥çœ‹æ‰€æœ‰ç¼–è¯‘é€‰é¡¹ (çœŸä¸å°‘)printf å˜æˆäº† puts@plt
gcc -Wl,--verbose å¯ä»¥æŸ¥çœ‹æ‰€æœ‰é“¾æ¥é€‰é¡¹ (çœŸä¸å°‘)åŸæ¥é“¾æ¥äº†é‚£ä¹ˆå¤šä¸œè¥¿è¿˜è§£é‡Šäº† end ç¬¦å·çš„ç”±æ¥
gcc -static ä¼šé“¾æ¥ libc (å¤§é‡çš„ä»£ç )
```

å½“ä½¿ç”¨ä»¥ä¸Šå·¥å…·æŸ¥çœ‹ç”Ÿæˆçš„mainçš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œå‘ç°å¯æ‰§è¡Œæ–‡ä»¶å†…å®¹è¾ƒå¤šã€‚ç¼–è¯‘é“¾æ¥çš„è¿‡ç¨‹ä¼šé“¾æ¥åº“æ–‡ä»¶å¯¼è‡´å¯æ‰§è¡Œæ–‡ä»¶å˜å¤§ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å°è¯•ç€æ‰‹åŠ¨çš„å»é“¾æ¥å¯å®šä½æ–‡ä»¶ï¼Œå¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªmain.oæ–‡ä»¶ï¼Œç„¶åå°†è¿™ä¸ªmian.oè¯•ç€æ‰‹åŠ¨é“¾æ¥ç¼–è¯‘çš„æ–‡ä»¶

1. ç›´æ¥ç”¨ ld é“¾æ¥å¤±è´¥ï¼šå› ä¸ºld ä¸çŸ¥é“æ€ä¹ˆé“¾æ¥ printf

2. æ‰€ä»¥åªèƒ½ä¸è°ƒç”¨ printf ï¼Œå°†ç¨‹åºæ”¹ä¸ºä»¥ä¸‹å†…å®¹

   > ```c
   > int main()
   > {
   > }
   > ```
   >
   > è¿è¡Œæ—¶å‡ºç° Segmentation Fault ï¼Œè°ƒè¯•æ—¶å‘ç°åœ¨returnæ—¶å‡ºç°é”™è¯¯

3. å¦‚æœæ”¹æˆä»¥ä¸‹ä»£ç 

   >   ```c
   > int main()
   > {
   >        while(1);
   >}
   > ```
   >    
   > è¿è¡Œæ—¶ä¼šå¡åœ¨æ­»å¾ªç¯ä¸­ï¼Œè¯´æ˜æˆ‘ä»¬çš„ç¨‹åºæ—¶å¯ä»¥è¿è¡Œçš„


> [!NOTE]
>
> ä¸ºä»€ä¹ˆä¼šå‡ºç°`Segmention falut`ï¼Ÿ
>
> 1. å½“å‡½æ•°åœ¨`renturn`æ—¶ï¼Œç¨‹åºä¼šä»å†…å­˜çš„`rsp`å¯„å­˜å™¨ä¸­å–å‡ºåœ°å€ç»™`PC`ï¼Œä½œä¸ºä¸‹ä¸€æ¡æ‰§è¡ŒæŒ‡ä»¤çš„åœ°å€ï¼Œç„¶å`rsp`+8,æ ˆï¼ˆ`rsp`å­˜åœ¨æ ˆä¸­ï¼‰æ˜¯å‘ä¸‹ç”Ÿé•¿çš„
>
> 2. å½“æ‰§è¡Œå®Œé”™è¯¯çš„`return`è¯­å¥ä¹‹åï¼ŒPC`çš„åœ°å€å˜ä¸ºäº†`1
>
>    > è¿™æ„å‘³ç€åœ¨æ‰§è¡Œ`return`ä¹‹å‰ï¼Œå†…å­˜ä¸­çš„`rsp`æŒ‡å‘è¿è¡Œä»£ç çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä¸Šé¢çš„1ï¼Œæ‰€ä»¥å‡ºç°äº†é—®é¢˜

## ç¨‹åº

ç¨‹åºå®é™…ä¸Šæ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼š

```c
struct CPUState {
    uint32_t regs[32], csrs[CSR_COUNT];
    uint8_t *mem;
    uint32_t mem_offset, mem_size;
};
```

å¤„ç†å™¨ï¼šæ— æƒ…çš„ã€æ‰§è¡ŒæŒ‡ä»¤çš„**çŠ¶æ€æœº**

- ä» ğ‘€[ğ‘ƒğ¶]ä¸­å–å‡ºä¸€æ¡æŒ‡ä»¤
- æ‰§è¡Œå®ƒ
- å¾ªç¯å¾€å¤

### ç¨‹åº¦çš„é€€å‡º

ç¨‹åºè‡ªå·±æ˜¯ä¸èƒ½ â€œåœä¸‹æ¥â€ çš„!

- æŒ‡ä»¤é›†é‡Œ==æ²¡æœ‰ä¸€æ¡å…³é—­è®¡ç®—æœºçš„æŒ‡ä»¤==ï¼Œé‚£ä¹ˆæ“ä½œç³»ç»Ÿæ˜¯å¦‚ä½•åœ¨å…³é—­æ‰€æœ‰è½¯ä»¶åï¼Œåˆ‡æ–­è®¡ç®—æœºçš„ç”µæºçš„ï¼Ÿ

åªèƒ½å€ŸåŠ©æ“ä½œç³»ç»Ÿ

```assembly
movq $SYS_exit,  %rax   # exit( 
movq $1,         %rdi   #   status=1 
syscall                 # ); 
```

- æŠŠ â€œç³»ç»Ÿè°ƒç”¨â€ çš„å‚æ•°æ”¾åˆ°å¯„å­˜å™¨ä¸­
- æ‰§è¡Œ==syscall==ï¼Œæ“ä½œç³»ç»Ÿæ¥ç®¡ç¨‹åº
  - æ“ä½œç³»ç»Ÿå¯ä»¥ä»»æ„æ”¹å˜ç¨‹åºçŠ¶æ€ (ç”šè‡³ç»ˆæ­¢ç¨‹åº)

> [!TIP]
>
> `syscall`æ˜¯ä¸€æ¡ç‰¹æ®ŠæŒ‡ä»¤ï¼Œç”±æ“ä½œç³»ç»Ÿæä¾›ã€‚
>
> å½“`main`å‡½æ•°é€€å‡ºæ—¶ï¼Œå¯ä»¥ä½¿ç”¨`syscall`æŒ‡ä»¤å‘Šè¯‰æ“ä½œç³»ç»Ÿï¼Œç¨‹åºå³å°†é€€å‡ºï¼Œç„¶åç­‰å¾…`syscall`çš„å›åº”ï¼Œæ­¤æ—¶ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨å°±å®Œæˆäº†ã€‚

> [!TIP]
>
> åœ¨æ“ä½œç³»ç»Ÿä¹‹ä¸‹æ˜¯ç”µè·¯ï¼Œå®é™…ä¸Šåœ¨ä¸‹é¢çš„ç”µè·¯ä¹Ÿå¯ä»¥çœ‹æˆæœ‰ä¸€ä¸ªå°å‹çš„æ“ä½œç³»ç»Ÿï¼Œå½“ä¸Šå±‚æ“ä½œç³»ç»Ÿå‘åº•å±‚çš„æ“ä½œç³»ç»Ÿå‘é€æŒ‡ä»¤ä¹‹åï¼ˆé€šè¿‡ACPIï¼ˆé«˜çº§é…ç½®å’Œç”µæºæ¥å£ï¼‰è¿›è¡Œäº¤äº’ï¼‰ï¼Œåº•å±‚çš„æ“ä½œç³»ç»Ÿä¼šå‘å®ƒæ‰€ç®¡ç†çš„å…ƒå™¨ä»¶å‘é€é«˜ä½ç”µå¹³ï¼Œä»è€Œè¾¾åˆ°å…³æœºçš„æ•ˆæœ

æ­¤æ—¶å°±å¯ä»¥æ„é€ æœ€å°çš„ç¨‹åº

*==mininal.S==*

```assembly
#include // The x86-64 system call Application Binary Interface (ABI): 
// System call number: RAX
// Arguments: RDI, RSI, RDX, RCX, R8, R9 
// Return value: RAX 
// See also: syscall(2) syscalls(2) 
#define syscall3(id, a1, a2, a3) \
	movq $SYS_##id, %rax; \
	movq $a1, %rdi; \ 
	movq $a2, %rsi; \ 
	movq $a3, %rdx; \ 
	syscall 
#define syscall2(id, a1, a2) syscall3(id, a1, a2, 0) 
#define syscall1(id, a1) syscall2(id, a1, 0) 
.globl _start 
_start:
	syscall3(write, 1, addr1, addr2 - addr1) 
	syscall1(exit, 1) 
addr1: 
	.ascii "\033[01;31mHello, OS World\033[0m\n" 
addr2:
```

ä½¿ç”¨ä»¥ä¸‹æŒ‡ä»¤è¿è¡Œä¸Šé¢çš„æ±‡ç¼–ç¨‹åº

```bash
gcc -g -S minimal.S minimal.s
as minimal.s -o minimal.o
ld -o minimal minimal.o
./minimal
echo $status #ä½¿ç”¨è¯¥è¡ŒæŒ‡ä»¤æ‰“å°å‡ºRAXä¸­çš„å€¼
```



### ç¨‹åº = çŠ¶æ€æœº

==Everythingï¼ˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼‰=  çŠ¶æ€æœº==

çŠ¶æ€

- gdb å†…å¯è§çš„å†…å­˜å’Œå¯„å­˜å™¨

åˆå§‹çŠ¶æ€

- ç”± ABI è§„å®š (ä¾‹å¦‚æœ‰ä¸€ä¸ªåˆæ³•çš„ %rsp)

çŠ¶æ€è¿ç§»

- æ‰§è¡Œä¸€æ¡æŒ‡ä»¤
  - gdb å¯ä»¥å•æ­¥è§‚å¯ŸçŠ¶æ€æœºçš„æ‰§è¡Œ
- **syscall æŒ‡ä»¤**: å°†çŠ¶æ€æœº â€œå®Œå…¨äº¤ç»™â€ æ“ä½œç³»ç»Ÿ

> [!IMPORTANT]
>
> - çŠ¶æ€ = å˜é‡æ•°å€¼ + æ ˆ
> - åˆå§‹çŠ¶æ€ = main çš„ç¬¬ä¸€æ¡è¯­å¥
> - çŠ¶æ€è¿ç§» = æ‰§è¡Œä¸€æ¡è¯­å¥ä¸­çš„ä¸€å°æ­¥

## æ‹†è§£ç¨‹åº

> **æ“ä½œç³»ç»Ÿä¸Šæœ‰å¾ˆå¤šä¸åŒç§ç±»çš„ç¨‹åº**
>
> 1. Core Utilities (coreutils)
>
>    - *Standard* programs for text and file manipulation
>
>    - ç³»ç»Ÿä¸­é»˜è®¤å®‰è£…çš„æ˜¯ [GNU Coreutils](https://www.gnu.org/software/coreutils/)
>
> 2. ç³»ç»Ÿ/å·¥å…·ç¨‹åº
>
>    - bash,binutils, apt, ip, ssh, vim, tmux, gcc, python, ffmpeg, ...
>      - åŸç†ä¸å¤æ‚ (ä¾‹å¦‚ apt æ˜¯ dpkg çš„å¥—å£³)ï¼Œä½†çç¢
>
>    - All-in-one å·¥å…·åˆé›†ï¼š[busybox](https://www.busybox.net/), [toybox](https://landley.net/toybox/)
>
> 3. å…¶ä»–å„ç§åº”ç”¨ç¨‹åº
>    - Vscodeã€OBS-Studioã€æµè§ˆå™¨ã€éŸ³ä¹æ’­æ”¾å™¨ï¼šå®ƒä»¬åœ¨å„ç§å·¥å…·ç¨‹åºåŸºç¡€ä¸Šå»ºç«‹èµ·æ¥ (ä¾‹ï¼šffmpeg)

> **è¿½è¸ªä¸€ä¸ªç¨‹åº**
>
> å·¥å…·ç¨‹åºä»£è¡¨ï¼šç¼–è¯‘å™¨ (gcc):
>
> ```bash
> strace -f gcc a.c  #(gcc ä¼šå¯åŠ¨å…¶ä»–è¿›ç¨‹)
> ```
>
> - å¯ä»¥ç®¡é“ç»™ç¼–è¾‘å™¨ `vim -`
>
> - ç¼–è¾‘å™¨é‡Œè¿˜å¯ä»¥
>
>   ```
>   %!grep
>   ```
>
>   - å¯¹äºå¼€å‘è€…æ¥è¯´ï¼Œå·¥å…·çš„ç»„åˆæ˜¯éå¸¸é‡è¦çš„
>
> å›¾å½¢ç•Œé¢ç¨‹åºä»£è¡¨ï¼šç¼–è¾‘å™¨ (xedit):
>
> ```bash
> strace xedit
> ```
>
> - å›¾å½¢ç•Œé¢ç¨‹åºå’Œ X-Window æœåŠ¡å™¨æŒ‰ç…§ X11 åè®®é€šä¿¡
> - è™šæ‹Ÿæœºä¸­çš„ xedit å°† X11 å‘½ä»¤é€šè¿‡ ssh (X11 forwarding) è½¬å‘åˆ° Host



>**ä»»ä½•ç¨‹åº = minimal.S = çŠ¶æ€æœº**
>
>ç¨‹åºåœ¨æ“ä½œç³»ç»Ÿä¸Šçš„æ‰§è¡Œè¿‡ç¨‹ï¼š
>
>1. æ€»æ˜¯ä»è¢«æ“ä½œç³»ç»ŸåŠ è½½å¼€å§‹
>   - é€šè¿‡å¦ä¸€ä¸ªè¿›ç¨‹æ‰§è¡Œ execve è®¾ç½®ä¸ºåˆå§‹çŠ¶æ€
>
>2. ç»å†çŠ¶æ€æœºæ‰§è¡Œ (è®¡ç®— + syscalls)
>   - è¿›ç¨‹ç®¡ç†ï¼šfork, execve, exit, ...
>   - æ–‡ä»¶/è®¾å¤‡ç®¡ç†ï¼šopen, close, read, write, ...
>   - å­˜å‚¨ç®¡ç†ï¼šmmap, brk, ...
>
>3. æœ€ç»ˆè°ƒç”¨ _exit (exit_group) é€€å‡º
>
>
>
>==åº”ç”¨ç¨‹åº = è®¡ç®— + æ“ä½œç³»ç»Ÿ API==
>
>1. çª—å£ç®¡ç†å™¨
>   - èƒ½ç›´æ¥ç®¡ç†å±å¹•è®¾å¤‡ (read/write/mmap)
>     - èƒ½ç”»ä¸€ä¸ªç‚¹ï¼Œç†è®ºä¸Šå°±èƒ½ç”»ä»»ä½•ä¸œè¥¿
>
>   - èƒ½å¤Ÿå’Œå…¶ä»–è¿›ç¨‹é€šä¿¡ (send, recv)
>
>2. ä»»åŠ¡ç®¡ç†å™¨
>   - èƒ½è®¿é—®æ“ä½œç³»ç»Ÿæä¾›çš„è¿›ç¨‹å¯¹è±¡ ([M1 - pstree](https://jyywiki.cn/OS/2024/labs/M1.md))
>
>3. æ€æ¯’è½¯ä»¶
>   - æ–‡ä»¶é™æ€æ‰«æ (read)ã€ä¸»åŠ¨é˜²å¾¡ (ptrace)
>
>
>==æ“ä½œç³»ç»Ÿçš„èŒè´£ï¼šæä¾›ä»¤åº”ç”¨ç¨‹åº**èˆ’é€‚**çš„æŠ½è±¡ (å¯¹è±¡ + API)==

## ç¼–è¯‘å™¨

æ—¢ç„¶è¯´ â€œä»»ä½•ç¨‹åºâ€ éƒ½å’Œ minimal.S æ˜¯ä¸€æ ·çš„

- ä¸ºä»€ä¹ˆæˆ‘ä»¬æ²¡æœ‰åœ¨ C ä»£ç é‡Œçœ‹åˆ°ç³»ç»Ÿè°ƒç”¨ï¼Ÿ
- C ä»£ç æ˜¯å¦‚ä½•å˜æˆäºŒè¿›åˆ¶æ–‡ä»¶çš„ï¼Ÿ
- åˆ°åº•ç¼–è¯‘å™¨ä»€ä¹ˆä¼˜åŒ–èƒ½åšã€ä»€ä¹ˆä¼˜åŒ–ä¸èƒ½åšï¼Ÿ

> **å¦‚æœè¯´ç¨‹åºå°±æ˜¯ä¸€ä¸ªçŠ¶æ€æœºï¼Œé‚£ä¹ˆå¦‚ä½•å†™ä¸€ä¸ªCè¯­è¨€ä»£ç çš„è§£é‡Šå™¨ï¼Ÿ**
>
> åœ¨å†™Cè¯­è¨€çš„è§£é‡Šå™¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å°†Cä»£ç ç®€åŒ–ï¼Œå°†C ä»£ç æ”¹å†™æˆ SimpleCï¼Œå°†Cè½¬åŒ–ä¸ºSimpleCéœ€è¦éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š
>
> - æˆæ¯æ¡è¯­å¥è‡³å¤šä¸€æ¬¡è¿ç®— (å‡½æ•°è°ƒç”¨ä¹Ÿæ˜¯è¿ç®—)
> - æ¡ä»¶è¯­å¥ä¸­ä¸åŒ…å«è¿ç®—
>   - [çœŸçš„æœ‰è¿™ç§å·¥å…·](https://cil-project.github.io/cil/) (C Intermediate Language) å’Œ[è§£é‡Šå™¨](https://gitlab.com/zsaleeba/picoc)
> - (æš‚æ—¶å‡è®¾æ²¡æœ‰æŒ‡é’ˆå’Œå†…å­˜åˆ†é…)
>
> Everything (C ç¨‹åº) = çŠ¶æ€æœº
>
> - çŠ¶æ€ = å˜é‡æ•°å€¼ + æ ˆ
> - åˆå§‹çŠ¶æ€ = main çš„ç¬¬ä¸€æ¡è¯­å¥
> - çŠ¶æ€è¿ç§» = æ‰§è¡Œä¸€æ¡è¯­å¥ä¸­çš„ä¸€å°æ­¥

> **çŠ¶æ€æœº**
>
> â€œçŠ¶æ€æœºâ€ æ˜¯æ‹¥æœ‰**ä¸¥æ ¼æ•°å­¦å®šä¹‰**çš„å¯¹è±¡ã€‚è¿™æ„å‘³ç€ä½ å¯ä»¥æŠŠå®šä¹‰å†™å‡ºæ¥ï¼Œå¹¶ä¸”ç”¨**æ•°å­¦ä¸¥æ ¼**çš„æ–¹æ³•ç†è§£å®ƒ â€”â€” å½¢å¼åŒ–æ–¹æ³•
>
> çŠ¶æ€ï¼š
>
> - [StackFrame, StackFrame, ...] + å…¨å±€å˜é‡
>
>   > å®é™…ä¸Šä¸€ä¸ªçŠ¶æ€å°±æ˜¯ä¸€ä¸ªæ ˆå¸§
>
> åˆå§‹çŠ¶æ€ï¼š
>
> - ä»…æœ‰ä¸€ä¸ª StackFrame(main, argc, argv, **PC=0**)
> - å…¨å±€å˜é‡å…¨éƒ¨ä¸ºåˆå§‹å€¼
> - æ¯ä¸ªæ ˆå¸§ä¸­éƒ½æœ‰ä¸€ä¸ªPCå€¼ï¼Œç”¨æ¥ä¿å­˜å½“å‰çš„æ‰§è¡ŒæŒ‡é’ˆ
>
> çŠ¶æ€è¿ç§»ï¼š
>
> - æ‰§è¡Œ frames[-1].PC å¤„çš„ç®€å•è¯­å¥

> **ä»€ä¹ˆæ˜¯ç¼–è¯‘å™¨**
>
> ç¼–è¯‘å™¨çš„è¾“å…¥
>
> - é«˜çº§è¯­è¨€ (C) ä»£ç  = çŠ¶æ€æœº
>
> ç¼–è¯‘å™¨çš„è¾“å‡º
>
> - æ±‡ç¼–ä»£ç  (æŒ‡ä»¤åºåˆ—) = çŠ¶æ€æœº
>
> ç¼–è¯‘å™¨ = **çŠ¶æ€æœºä¹‹é—´çš„ç¿»è¯‘å™¨**

> **SimpleCçš„ç›´æ¥ç¿»è¯‘**
>
> è¿ç®—ï¼š
>
> - æŠŠæ“ä½œæ•° load åˆ°å¯„å­˜å™¨ã€æ‰§è¡Œè¿ç®—ã€store å†™å›ç»“æœ
>
> åˆ†æ”¯/å¾ªç¯ï¼š
>
> - ä½¿ç”¨æ¡ä»¶è·³è½¬åˆ†åˆ«æ‰§è¡Œä»£ç 
>
> å‡½æ•°è°ƒç”¨ï¼š
>
> - **ä¸“é—¨ç•™ä¸€ä¸ªå¯„å­˜å™¨ç»™æ ˆ** (SP, Stack Pointer)
> - å°† Stack frame çš„ä¿¡æ¯ä¿å­˜åœ¨å†…å­˜é‡Œ
>   - é€šè¿‡ SP å¯ä»¥è®¿é—®å½“å‰æ ˆå¸§çš„å˜é‡ã€è¿”å›åœ°å€ç­‰
>
> æ‰€ä»¥ï¼Œ==C è¢«ç§°ä¸º**é«˜çº§æ±‡ç¼–è¯­è¨€**==
>
> - å­˜åœ¨ C ä»£ç åˆ°æŒ‡ä»¤é›†çš„ç›´æ¥å¯¹åº”å…³ç³»
>   - çŠ¶æ€æœºå’Œè¿ç§»éƒ½å¯ä»¥ â€œç›´è¯‘â€
>   - äºæ˜¯è®¡ç®—æœºç³»ç»Ÿé‡Œå¤šäº†ä¸€ä¸ªæŠ½è±¡å±‚ (â€œä¸€ç”ŸäºŒã€äºŒç”Ÿä¸‰ã€ä¸‰ç”Ÿä¸‡ç‰©â€)
> - æ›´ â€œé«˜çº§â€ çš„è¯­è¨€å°±å¾ˆéš¾äº†
>   - C++ `virtual void foo();`
>   - Python `[1, 2, 3, *rest]`
>   - Javascript `await fetch(...)`

> **ç¼–è¯‘ä¼˜åŒ–**
>
> > C è¯­è¨€ç¼–è¯‘å™¨åœ¨è¿›è¡Œä»£ç ä¼˜åŒ–æ—¶ï¼Œéµå¾ªçš„åŸºæœ¬å‡†åˆ™æ˜¯åœ¨ä¸æ”¹å˜ç¨‹åºçš„==è¯­ä¹‰== (å³ç¨‹åºçš„è¡Œä¸ºå’Œè¾“å‡ºç»“æœ) çš„å‰æä¸‹ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡å’Œ/æˆ–å‡å°‘ç¨‹åºçš„èµ„æºæ¶ˆè€—
>
> ```c
> int foo(int x)
> {  
>     int y = x + 1; 
>     return y - 1; 
> } 
> ```
>
> ä¸€äº› â€œä¸æ”¹å˜è¯­ä¹‰â€ çš„ä¾‹å­ (ç¼–è¯‘ä¼˜åŒ–ä¸­æœ€é‡è¦çš„ â€œä¸‰æ¿æ–§â€)ï¼š
>
> - **å‡½æ•°å†…è”**ï¼šå°†å‡½æ•°è°ƒç”¨æ›¿æ¢ä¸ºå‡½æ•°ä½“æœ¬èº«çš„å†…å®¹
> - **å¸¸é‡ä¼ æ’­**ï¼šåœ¨ç¼–è¯‘æ—¶è®¡ç®—å¸¸é‡è¡¨è¾¾å¼çš„å€¼å¹¶æ›¿æ¢
> - **æ­»ä»£ç æ¶ˆé™¤**ï¼šåˆ é™¤æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œåˆ°çš„ä»£ç 
>
> ä¾‹å­
>
> ---
>
> > *==ç¼–è¯‘ä¼˜åŒ–å‰==*
> >
> > ```c
> > int compute(int x)
> > {
> > 	int y = x + 1;
> > 	return y - 1;
> > }
> > ```
> >
> > *==ç¼–è¯‘ä¼˜åŒ–å‰==*
> >
> > ```c
> > int compute(int x)
> > {
> >     if(true)
> >     {
> >         x = 1;
> >     }
> >     else
> >     {
> >         
> >     }
> >     return x;
> > }
> > ```
>
> > *==ç¼–è¯‘ä¼˜åŒ–å==*
> >
> > ```
> > int compute(int x)
> > {
> > 	return x;
> > }
> > ```
> >
> > *==ç¼–è¯‘ä¼˜åŒ–å==*
> >
> > ```c
> > int compute(int x)
> > {
> >     //if(true) æ­»ä»£ç æ¶ˆé™¤
> >     //{
> >    	//    x = 1; å¸¸é‡ä¼ æ’­
> >     //}
> >     //else æ­»ä»£ç æ¶ˆé™¤
> >     //{
> >     //}
> >     //return x;
> >     return 1; //å¸¸é‡ä¼ æ’­
> > }
> > ```
> >
> > 

> **ç¼–è¯‘çš„æ­£ç¡®æ€§**
>
> ç³»ç»Ÿè°ƒç”¨æ˜¯ä½¿ç¨‹åºè®¡ç®—ç»“æœ**å¯è§**çš„å”¯ä¸€æ–¹æ³•
>
> - ä¸æ”¹å˜è¯­ä¹‰ = ä¸æ”¹å˜å¯è§ç»“æœ
> - çŠ¶æ€æœºçš„è§†è§’ï¼šæ»¡è¶³**C/æ±‡ç¼–çŠ¶æ€æœºç”Ÿæˆçš„æ‰€æœ‰ syscall åºåˆ—å®Œå…¨ä¸€è‡´**ï¼Œä»»ä½•ä¼˜åŒ–éƒ½æ˜¯å…è®¸çš„
>
> C ä»£ç ä¸­çš„**ä¸å¯ä¼˜åŒ–éƒ¨åˆ†**
>
> - External function calls (é“¾æ¥æ—¶æ‰èƒ½ç¡®å®šåˆ°åº•æ˜¯ä»€ä¹ˆä»£ç )
>   - æœªçŸ¥çš„ä»£ç å¯èƒ½åŒ…å«**ç³»ç»Ÿè°ƒç”¨**
>   - å› æ­¤ä¸å¯åˆ é™¤ã€ç§»å‡ºå¾ªç¯ç­‰ï¼Œä¸”è¦ä¿è¯å‚æ•°ä¼ é€’å®Œå…¨ä¸€è‡´
> - ç¼–è¯‘å™¨æä¾›çš„ â€œä¸å¯ä¼˜åŒ–â€ æ ‡æ³¨
>   - `volatile` [load | store | inline assembly]

# ç¡¬ä»¶è§†è§’ä¸‹çš„æ“ä½œç³»ç»Ÿ



resetä¹‹åæ‰§è¡Œfirmware





























































































































